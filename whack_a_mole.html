<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ‹èªç›¸ä¼¼å­—å¤§è€ƒé©—-15é¡Œéé—œç‰ˆ</title>
    <style>
        :root { --primary: #4CAF50; --gold: #FFD700; --error: #F44336; --bg: #2c3e50; }
        body { margin: 0; padding: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; }
        
        #header {
            width: 100%; height: 60px; background: rgba(0,0,0,0.8);
            display: flex; justify-content: space-around; align-items: center;
            color: white; font-size: 20px; font-weight: bold; z-index: 100;
        }

        #quiz-display {
            width: 90%; background: white; margin: 15px 0;
            padding: 15px; border-radius: 15px; border: 4px solid var(--primary);
            font-size: 32px; font-weight: bold; text-align: center; color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); min-height: 45px;
        }

        #game-area {
            position: relative; width: 95vw; max-width: 500px;
            height: 50vh; background: #8BC34A;
            border-radius: 20px; border: 8px solid #5D4037;
            display: grid; grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px; padding: 15px; box-sizing: border-box;
        }

        .mole-hole {
            background: #3E2723; border-radius: 50%;
            position: relative; overflow: hidden;
            box-shadow: inset 0 8px 15px rgba(0,0,0,0.6);
        }

        .mole-word {
            position: absolute; bottom: -100%; width: 100%; height: 100%;
            background: #FFE082; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 36px; font-weight: bold; transition: bottom 0.15s ease-out;
            cursor: pointer; user-select: none;
        }
        .mole-word.up { bottom: 0; }
        .mole-word.hit { background: var(--primary); color: white; }
        .mole-word.miss { background: var(--error); color: white; }

        #timer-container { width: 90%; height: 12px; background: #eee; border-radius: 6px; margin-top: 15px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--gold); }

        #instruction {
            width: 90%; margin-top: 15px; padding: 12px;
            background: rgba(255,255,255,0.1); color: #ddd;
            border-radius: 10px; font-size: 15px; line-height: 1.6;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 200; color: white; text-align: center;
        }
        .btn { background: var(--primary); border: none; padding: 15px 50px; color: white; font-size: 26px; border-radius: 50px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="header">
        <div>ğŸš© é—œå¡: <span id="level-name">L7-L9</span></div>
        <div>â¤ï¸ ç”Ÿå‘½: <span id="hp-ui">3</span></div>
        <div>ğŸ† é€²åº¦: <span id="count-ui">0</span>/15</div>
    </div>

    <div id="quiz-display">æº–å‚™æŒ‘æˆ°...</div>

    <div id="game-area">
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
        <div class="mole-hole"><div class="mole-word"></div></div>
    </div>

    <div id="timer-container"><div id="timer-bar"></div></div>

    <div id="instruction">
        <strong>ğŸ“ æ“ä½œèªªæ˜ï¼š</strong><br>
        1. çœ‹ä¸Šæ–¹é¡Œç›®ï¼šåˆ¤æ–·æ­£ç¢ºçš„å­—æˆ–æ³¨éŸ³ã€‚<br>
        2. é»æ“Šåœ°é¼ ï¼šå¾å½ˆå‡ºçš„åœ°é¼ ä¸­æ‰¾å‡ºæ­£ç¢ºç­”æ¡ˆä¸¦é»æ“Šã€‚<br>
        3. æ¯é—œåªéœ€ç­”å° <strong>15 é¡Œ</strong> å³å¯éé—œï¼<br>
    </div>

    <div id="overlay-screen" class="overlay">
        <h1 id="overlay-title">ç›¸ä¼¼å­—æ‰“åœ°é¼ </h1>
        <p id="overlay-desc">ç¬¬ä¸€é—œï¼šç¬¬ 7 èª²è‡³ç¬¬ 9 èª²</p>
        <button class="btn" id="start-btn" onclick="handleStart()">é–‹å§‹æŒ‘æˆ°</button>
    </div>

    <script>
        let allData = [];
        let currentQuiz = null;
        let hp = 3;
        let scoreInLevel = 0;
        let currentLevelNum = 1; 
        let gameActive = false;
        let moleWords = [];
        let timerInterval;

        async function init() {
            try {
                const res = await fetch('quiz.json');
                allData = await res.json();
                moleWords = Array.from(document.querySelectorAll('.mole-word'));
            } catch (e) { alert("è®€å–é¡Œåº«å¤±æ•—ï¼"); }
        }

        function handleStart() {
            if (currentLevelNum === 1 || hp <= 0) {
                hp = 3; scoreInLevel = 0;
            } else {
                scoreInLevel = 0;
            }
            document.getElementById('overlay-screen').style.display = 'none';
            updateUI();
            gameActive = true;
            nextRound();
        }

        function nextRound() {
            if (!gameActive) return;

            // é–€æª»èª¿æ•´ç‚º 15 é¡Œ
            if (scoreInLevel >= 15) {
                if (currentLevelNum === 1) { winLevel1(); } else { winGame(); }
                return;
            }

            moleWords.forEach(mw => mw.classList.remove('up', 'hit', 'miss'));
            cancelAnimationFrame(timerInterval);

            const pool = allData.filter(d => d.level === currentLevelNum);
            currentQuiz = pool[Math.floor(Math.random() * pool.length)];
            document.getElementById('quiz-display').innerText = currentQuiz.q;

            const shuffledOptions = [...currentQuiz.options].sort(() => Math.random() - 0.5);
            const holes = [];
            while(holes.length < 3) {
                let r = Math.floor(Math.random() * 9);
                if(!holes.includes(r)) holes.push(r);
            }

            holes.forEach((hIndex, i) => {
                const mw = moleWords[hIndex];
                mw.innerText = shuffledOptions[i];
                mw.onclick = () => checkAns(mw, shuffledOptions[i]);
                setTimeout(() => mw.classList.add('up'), 50);
            });

            startTimer();
        }

        function checkAns(el, text) {
            if (el.classList.contains('hit') || el.classList.contains('miss')) return;
            if (text === currentQuiz.ans) {
                scoreInLevel++;
                el.classList.add('hit');
                setTimeout(nextRound, 300);
            } else {
                hp--;
                el.classList.add('miss');
                flashRed();
                if (hp <= 0) gameOver();
                else setTimeout(nextRound, 800);
            }
            updateUI();
        }

        function startTimer() {
            const timeLimit = currentLevelNum === 1 ? 7000 : 5000; 
            let start = Date.now();
            const animate = () => {
                let now = Date.now();
                let remaining = Math.max(0, timeLimit - (now - start));
                document.getElementById('timer-bar').style.width = (remaining / timeLimit) * 100 + "%";
                if (remaining <= 0) {
                    hp--;
                    updateUI();
                    if (hp <= 0) gameOver(); else nextRound();
                } else {
                    timerInterval = requestAnimationFrame(animate);
                }
            };
            timerInterval = requestAnimationFrame(animate);
        }

        function updateUI() {
            document.getElementById('hp-ui').innerText = hp;
            document.getElementById('count-ui').innerText = scoreInLevel;
            document.getElementById('level-name').innerText = currentLevelNum === 1 ? "L7-L9" : "L10-L12";
        }

        function flashRed() {
            document.body.style.background = "#8e241c";
            setTimeout(() => document.body.style.background = "#2c3e50", 150);
        }

        function winLevel1() {
            gameActive = false;
            currentLevelNum = 2;
            const screen = document.getElementById('overlay-screen');
            document.getElementById('overlay-title').innerText = "ğŸ‰ L7-L9 æŒ‘æˆ°æˆåŠŸï¼";
            document.getElementById('overlay-desc').innerText = "ä¸‹ä¸€é—œï¼šL10-L12\næº–å‚™å¥½äº†å—ï¼Ÿ";
            document.getElementById('start-btn').innerText = "é€²å…¥ç¬¬äºŒé—œ";
            screen.style.display = 'flex';
        }

        function winGame() {
            gameActive = false;
            const screen = document.getElementById('overlay-screen');
            document.getElementById('overlay-title').innerText = "ğŸ† å®Œç¾å…¨é€šé—œï¼";
            document.getElementById('overlay-desc').innerText = "L7-L12 çš„å­—è¾¨èˆ‡æ³¨éŸ³éƒ½é›£ä¸å€’ä½ äº†ï¼";
            document.getElementById('start-btn').innerText = "å†ç©ä¸€æ¬¡";
            currentLevelNum = 1;
            screen.style.display = 'flex';
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(timerInterval);
            const screen = document.getElementById('overlay-screen');
            document.getElementById('overlay-title').innerText = "ğŸ‘» å†æ¥å†å²";
            document.getElementById('overlay-desc').innerText = "å·®ä¸€é»å°±éé—œäº†ï¼Œå†è©¦ä¸€æ¬¡å§ï¼";
            document.getElementById('start-btn').innerText = "é‡æ–°æŒ‘æˆ°";
            screen.style.display = 'flex';
        }

        init();
    </script>
</body>
</html>