<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é£›é¾ç›¸ä¼¼å­—/æ³¨éŸ³å¤§æ¢éšª</title>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --error: #e74c3c; --sky: #87CEEB; }
        body { margin: 0; padding: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background: #222; }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%);
            overflow: hidden;
            display: none;
        }

        /* é›²æœµèƒŒæ™¯ */
        .cloud { position: absolute; background: white; border-radius: 50px; opacity: 0.8; z-index: 1; }

        /* é£›é¾ */
        #dragon {
            position: absolute;
            left: 50px;
            top: 50%;
            font-size: 50px;
            z-index: 10;
            transition: transform 0.1s;
            user-select: none;
        }

        /* ç­”æ¡ˆçƒ */
        .bubble {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.9);
            border: 4px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 5;
            cursor: pointer;
        }

        /* ä»‹é¢ */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 20;
        }
        .stats { position: absolute; top: 20px; left: 20px; font-size: 20px; color: #2c3e50; font-weight: bold; pointer-events: auto; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 10px; }
        
        #quiz-bar {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid var(--primary);
            white-space: nowrap;
        }

        /* éŠæˆ²èªªæ˜æ¬„ */
        #instruction-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            width: 80%;
            max-width: 600px;
        }

        /* é¸å–®èˆ‡çµæŸç•«é¢ */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            text-align: center;
        }
        .btn {
            background: var(--success);
            border: none;
            padding: 15px 40px;
            color: white;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 0 #27ae60;
        }
        .btn:active { transform: translateY(3px); box-shadow: none; }
    </style>
</head>
<body onclick="boost()" onkeydown="if(event.code==='Space') boost()">

    <div id="game-container">
        <div id="dragon">ğŸ‰</div>

        <div id="ui-layer">
            <div class="stats">
                â¤ï¸ ç”Ÿå‘½: <span id="hp">3</span> | ğŸ† åˆ†æ•¸: <span id="score">0</span>
            </div>
            <div id="quiz-bar">è®€å–é¡Œç›®ä¸­...</div>
            
            <div id="instruction-bar">
                <strong>ğŸ•¹ï¸ éŠæˆ²æ–¹å¼ï¼š</strong><br>
                æ‰‹æ©Ÿï¼šé»æ“Šè¢å¹•ä»»ä½•åœ°æ–¹é£›é¾å°±æœƒå¾€ä¸Šè¡ï¼ / é›»è…¦ï¼šæŒ‰ã€ç©ºç™½éµã€‘å‘ä¸Šé£›è¡Œã€‚<br>
                æ§åˆ¶é£›é¾å»åƒå¸¶æœ‰ã€Œæ­£ç¢ºç­”æ¡ˆã€çš„çƒï¼Œé¿é–‹éŒ¯èª¤ç­”æ¡ˆã€‚åƒéŒ¯æˆ–æ’åœ°æœƒæ‰£è¡€å–”ï¼
            </div>
        </div>
    </div>

    <div id="menu" class="overlay">
        <h1>ğŸ‰ é£›é¾ç›¸ä¼¼å­—å¤§æ¢éšª</h1>
        <p>æº–å‚™å¥½æŒ‘æˆ° 100 é¡Œç›¸ä¼¼å­—èˆ‡æ³¨éŸ³äº†å—ï¼Ÿ</p>
        <button class="btn" onclick="startGame()">é–‹å§‹é£›è¡Œ</button>
    </div>

    <script>
        let allData = [];
        let currentQ = null;
        let hp = 3;
        let score = 0;
        let dragonY = 300;
        let velocity = 0;
        let gravity = 0.4;
        let isGameOver = false;
        let bubbles = [];
        let gameActive = false;

        async function init() {
            try {
                const res = await fetch('quiz.json');
                allData = await res.json();
            } catch (e) {
                alert("æ‰¾ä¸åˆ° quiz.jsonï¼Œè«‹ç¢ºèªæª”æ¡ˆåœ¨åŒä¸€å€‹è³‡æ–™å¤¾ã€‚");
            }
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            resetGame();
            gameActive = true;
            requestAnimationFrame(gameLoop);
            spawnQuiz();
        }

        function resetGame() {
            hp = 3; score = 0; dragonY = 300; velocity = 0;
            isGameOver = false; bubbles = [];
            const container = document.getElementById('game-container');
            document.querySelectorAll('.bubble').forEach(b => b.remove());
            updateUI();
        }

        function boost() {
            if(!gameActive || isGameOver) return;
            velocity = -8;
            document.getElementById('dragon').style.transform = 'rotate(-20deg)';
        }

        function spawnQuiz() {
            if(isGameOver) return;
            currentQ = allData[Math.floor(Math.random() * allData.length)];
            document.getElementById('quiz-bar').innerText = currentQ.q;
            
            // ç”¢ç”Ÿä¸‰å€‹æ³¡æ³¡
            const container = document.getElementById('game-container');
            const h = window.innerHeight;
            const shuffledOptions = [...currentQ.options].sort(() => Math.random() - 0.5);
            
            shuffledOptions.forEach((text, i) => {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.innerText = text;
                b.style.right = '-100px';
                b.style.top = (h * 0.2) + (i * (h * 0.2)) + 'px'; // åˆ†æ•£é«˜åº¦
                container.appendChild(b);
                bubbles.push({
                    el: b,
                    x: window.innerWidth,
                    y: (h * 0.2) + (i * (h * 0.2)),
                    text: text
                });
            });
        }

        function gameLoop() {
            if(!gameActive || isGameOver) return;

            // é£›é¾ç‰©ç†
            velocity += gravity;
            dragonY += velocity;
            const dragonEl = document.getElementById('dragon');
            dragonEl.style.top = dragonY + 'px';
            
            // æ—‹è½‰å¾®èª¿
            if(velocity > 0) dragonEl.style.transform = 'rotate(10deg)';

            // é‚Šç•Œæª¢æŸ¥
            if(dragonY < 0 || dragonY > window.innerHeight - 150) {
                hitError();
                dragonY = 300;
                velocity = 0;
            }

            // æ³¡æ³¡ç§»å‹•èˆ‡ç¢°æ’
            for (let i = bubbles.length - 1; i >= 0; i--) {
                let b = bubbles[i];
                b.x -= (4 + score/10); // éš¨åˆ†æ•¸è®Šå¿«
                b.el.style.left = b.x + 'px';

                // ç¢°æ’æª¢æ¸¬ (ç°¡å–®çŸ©å½¢æª¢æ¸¬)
                if (b.x < 100 && b.x > 30) {
                    const dy = dragonY + 25;
                    if (dy > b.y && dy < b.y + 80) {
                        checkAnswer(b.text);
                        clearBubbles();
                        break;
                    }
                }

                // æ²’åƒåˆ°çƒï¼Œé£›å‡ºè¢å¹•
                if (b.x < -100) {
                    clearBubbles();
                    spawnQuiz();
                    break;
                }
            }

            requestAnimationFrame(gameLoop);
        }

        function checkAnswer(ans) {
            if (ans === currentQ.ans) {
                score++;
                document.getElementById('quiz-bar').style.color = 'var(--success)';
                setTimeout(() => {
                    document.getElementById('quiz-bar').style.color = '#2c3e50';
                    spawnQuiz();
                }, 500);
            } else {
                hitError();
                spawnQuiz();
            }
            updateUI();
        }

        function hitError() {
            hp--;
            updateUI();
            document.getElementById('game-container').style.background = '#ffcccc';
            setTimeout(() => {
                document.getElementById('game-container').style.background = 'linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%)';
            }, 200);
            
            if (hp <= 0) {
                isGameOver = true;
                showGameOver();
            }
        }

        function clearBubbles() {
            bubbles.forEach(b => b.el.remove());
            bubbles = [];
        }

        function updateUI() {
            document.getElementById('hp').innerText = hp;
            document.getElementById('score').innerText = score;
        }

        function showGameOver() {
            const menu = document.getElementById('menu');
            menu.innerHTML = `
                <h1>ğŸ’¥ å¢œæ©Ÿå•¦ï¼</h1>
                <p>ä½ çš„é£›é¾åŠªåŠ›è¾¨è­˜äº† ${score} å€‹å­—ï¼</p>
                <button class="btn" onclick="location.reload()">å†è©¦ä¸€æ¬¡</button>
            `;
            menu.style.display = 'flex';
        }

        init();
    </script>
</body>
</html>