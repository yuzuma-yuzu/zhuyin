<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é£›é¾å¤§æ¢éšª-ç°¡æ˜“ä¿®æ­£ç‰ˆ</title>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --error: #e74c3c; }
        body { margin: 0; padding: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background: #87CEEB; touch-action: none; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }

        /* ä¸‰æ¢è»Œé“ä¸­å¿ƒç·š (éš±å½¢æˆ–æ·¡æ·¡çš„) */
        .lane-guide { position: absolute; width: 100%; height: 1px; background: rgba(255,255,255,0.2); left: 0; z-index: 1; }

        /* é£›é¾ï¼šä½ç½®èª¿æ•´ */
        #dragon {
            position: absolute;
            left: 8%;
            font-size: 65px; /* å¹³æ¿ä¸Šæ”¾å¤§ä¸€é» */
            z-index: 10;
            transition: top 0.15s ease-out;
            user-select: none;
            filter: drop-shadow(2px 2px 5px rgba(0,0,0,0.2));
        }

        /* ç­”æ¡ˆçƒ */
        .bubble {
            position: absolute;
            width: 110px;
            height: 110px;
            background: rgba(255, 255, 255, 0.95);
            border: 6px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            z-index: 5;
        }

        /* UI å±¤æ¬¡èª¿æ•´ */
        .stats { 
            position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
            font-size: 24px; font-weight: bold; z-index: 30; 
            background: rgba(255,255,255,0.8); padding: 5px 25px; border-radius: 20px;
            display: flex; gap: 20px;
        }
        
        /* é¡Œç›®æ¬„ï¼šç§»åˆ°æœ€ä¸‹æ–¹ï¼Œé¿å…é®æ“‹ */
        #quiz-bar {
            position: absolute;
            bottom: 30px; left: 50%; transform: translateX(-50%);
            background: white; padding: 15px 40px; border-radius: 50px;
            font-size: 40px; font-weight: bold; border: 5px solid var(--primary);
            z-index: 30; width: 85%; text-align: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100; color: white;
            text-align: center;
        }
        .instruction-box { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin: 20px; border: 1px dashed #aaa; }
        .btn { background: var(--success); border: none; padding: 20px 60px; color: white; font-size: 30px; border-radius: 60px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="stats">
            <span>â¤ï¸ <span id="hp">3</span></span>
            <span>ğŸ† <span id="score">0</span></span>
        </div>

        <div id="dragon">ğŸ‰</div>

        <div id="quiz-bar">è¼‰å…¥é¡Œåº«ä¸­...</div>
    </div>

    <div id="menu" class="overlay">
        <h1>ğŸ‰ é£›é¾å¤§æ¢éšª</h1>
        <div class="instruction-box">
            <p style="font-size: 24px; color: #ffeb3b;">ç°¡å–®ç©æ³•ï¼š</p>
            <p>é»æ“Šè¢å¹•ã€ä¸ŠåŠéƒ¨ã€‘é£›é¾å¾€ä¸Šç§»</p>
            <p>é»æ“Šè¢å¹•ã€ä¸‹åŠéƒ¨ã€‘é£›é¾å¾€ä¸‹ç§»</p>
            <p>åƒæ‰æ­£ç¢ºçš„å­—æˆ–æ³¨éŸ³ï¼Œé¿é–‹éŒ¯å­—ï¼</p>
        </div>
        <button class="btn" onclick="startGame()">é»æ“Šé–‹å§‹</button>
    </div>

    <script>
        let allData = [];
        let currentQ = null;
        let hp = 3;
        let score = 0;
        let currentLane = 1; 
        const laneY = [22, 48, 74]; // é‡æ–°è¨ˆç®—éçš„æ¯”ä¾‹ï¼Œé¿é–‹åº•éƒ¨é¡Œç›®æ¬„
        let bubbles = [];
        let gameActive = false;

        async function init() {
            try {
                const res = await fetch('quiz.json');
                allData = await res.json();
            } catch (e) { alert("è®€å–é¡Œåº«å¤±æ•—ï¼Œè«‹ç¢ºèª quiz.json å­˜åœ¨ã€‚"); }
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            hp = 3; score = 0; updateUI();
            moveDragon();
            gameActive = true;
            spawnQuiz();
            requestAnimationFrame(gameLoop);
        }

        // å¹³æ¿å„ªåŒ–ï¼šé»æ“Šå€åŸŸåˆ¤æ–·
        function handleInput(y) {
            if (!gameActive) return;
            if (y < window.innerHeight / 2) {
                if (currentLane > 0) currentLane--;
            } else {
                if (currentLane < 2) currentLane++;
            }
            moveDragon();
        }

        window.addEventListener('mousedown', (e) => handleInput(e.clientY));
        window.addEventListener('touchstart', (e) => {
            handleInput(e.touches[0].clientY);
            e.preventDefault();
        }, {passive: false});

        function moveDragon() {
            const dragon = document.getElementById('dragon');
            dragon.style.top = `${laneY[currentLane]}%`;
            dragon.style.transform = 'translateY(-50%)';
        }

        function spawnQuiz() {
            currentQ = allData[Math.floor(Math.random() * allData.length)];
            document.getElementById('quiz-bar').innerText = currentQ.q;
            
            const shuffledOptions = [...currentQ.options].sort(() => Math.random() - 0.5);
            shuffledOptions.forEach((text, i) => {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.innerText = text;
                b.style.left = '110vw';
                b.style.top = `${laneY[i]}%`;
                b.style.transform = 'translateY(-50%)';
                document.getElementById('game-container').appendChild(b);
                bubbles.push({ el: b, x: window.innerWidth * 1.1, lane: i, text: text });
            });
        }

        function gameLoop() {
            if (!gameActive) return;

            for (let i = bubbles.length - 1; i >= 0; i--) {
                let b = bubbles[i];
                b.x -= 6 + (score * 0.15); // ç¨å¾®åŠ å¿«åŸºç¤é€Ÿåº¦
                b.el.style.left = b.x + 'px';

                // ç¢°æ’æª¢æŸ¥ (å„ªåŒ–ç¢°æ’åŠå¾‘)
                if (b.x < window.innerWidth * 0.18 && b.x > window.innerWidth * 0.05) {
                    if (b.lane === currentLane) {
                        checkAnswer(b.text);
                        clearBubbles();
                        spawnQuiz();
                        break;
                    }
                }

                if (b.x < -150) {
                    clearBubbles();
                    spawnQuiz();
                    break;
                }
            }
            requestAnimationFrame(gameLoop);
        }

        function checkAnswer(ans) {
            if (ans === currentQ.ans) {
                score++;
                // ç­”å°æ•ˆæœï¼šé¡Œç›®è®Šç¶ ä¸€ä¸‹
                document.getElementById('quiz-bar').style.borderColor = 'var(--success)';
                setTimeout(()=>document.getElementById('quiz-bar').style.borderColor = 'var(--primary)', 300);
            } else {
                hp--;
                flashScreen();
            }
            updateUI();
            if (hp <= 0) gameOver();
        }

        function flashScreen() {
            document.body.style.background = "#ff6666";
            setTimeout(() => { document.body.style.background = "#87CEEB"; }, 200);
        }

        function clearBubbles() {
            bubbles.forEach(b => b.el.remove());
            bubbles = [];
        }

        function updateUI() {
            document.getElementById('hp').innerText = hp;
            document.getElementById('score').innerText = score;
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('menu').innerHTML = `
                <h1 style="font-size: 50px;">æŒ‘æˆ°çµæŸï¼</h1>
                <p style="font-size: 30px;">æ­å–œç²å¾— ${score} åˆ†</p>
                <button class="btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
            `;
        }

        init();
    </script>
</body>
</html>