<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›¸ä¼¼å­—çˆ¬å¡”å¤§å†’éšª - æœ€çµ‚ä¿®æ­£ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --error: #e74c3c; --bg: #2c3e50; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: white; }
        .game-container { background: #34495e; width: 95%; max-width: 500px; padding: 25px; border-radius: 24px; box-shadow: 0 15px 40px rgba(0,0,0,0.4); position: relative; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .hp-bar { color: var(--error); font-size: 1.4rem; letter-spacing: 3px; }
        .stage-info { background: #2980b9; padding: 6px 18px; border-radius: 20px; font-weight: bold; }

        /* é€²åº¦æ¢ */
        .progress-wrapper { width: 100%; height: 12px; background: #2c3e50; border-radius: 10px; margin-bottom: 40px; position: relative; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; border-radius: 10px; transition: 0.4s ease-out; }
        
        .character { 
            position: absolute; 
            top: -30px; 
            left: 0%; 
            transition: 0.4s ease-out; 
            font-size: 28px; 
            /* é¡åƒç¿»è½‰äººç‰©ï¼šè®“é è¨­é¢å‘å·¦é‚Šçš„å°äººæ”¹ç‚ºé¢å‘å³é‚Šè·‘ */
            transform: scaleX(-1); 
        }

        .quiz-box { background: white; color: #2c3e50; height: 140px; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2.1rem; font-weight: bold; margin-bottom: 25px; padding: 0 20px; text-align: center; line-height: 1.4; border-bottom: 5px solid #bdc3c7; }
        
        .options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .btn { background: var(--primary); border: none; padding: 18px 5px; color: white; font-size: 1.6rem; border-radius: 15px; cursor: pointer; transition: 0.1s; box-shadow: 0 5px 0 #2980b9; }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn.wrong { background: var(--error) !important; box-shadow: 0 5px 0 #c0392b !important; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.95); border-radius: 24px; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; padding: 20px; }
        .overlay h2 { font-size: 2.2rem; color: #fff; margin-bottom: 15px; }
        .msg { font-size: 1.1rem; color: #bdc3c7; margin-bottom: 30px; }
        .big-btn { width: 220px; background: var(--success); box-shadow: 0 5px 0 #27ae60; }
    </style>
</head>
<body>

<div class="game-container">
    <div class="top-bar">
        <div class="stage-info">ğŸ“ é—œå¡ <span id="lv-num">1</span></div>
        <div class="hp-bar" id="hp-display">â¤ï¸â¤ï¸â¤ï¸</div>
    </div>

    <div class="progress-wrapper">
        <div class="character" id="char">ğŸƒâ€â™‚ï¸</div>
        <div class="progress-fill" id="prog"></div>
    </div>

    <div class="quiz-box" id="q-text">è¼‰å…¥ä¸­...</div>

    <div class="options">
        <button class="btn" onclick="guess(0)" id="opt0">-</button>
        <button class="btn" onclick="guess(1)" id="opt1">-</button>
        <button class="btn" onclick="guess(2)" id="opt2">-</button>
    </div>

    <div class="overlay" id="screen">
        <h2 id="screen-title">ç›¸ä¼¼å­—å¤§å†’éšª</h2>
        <p class="msg" id="screen-msg">å¾å·¦å‘å³è¡åˆºï¼Œå®Œæˆ 10 é¡Œåˆ°é”çµ‚é»ï¼</p>
        <button class="btn big-btn" onclick="startStage()" id="screen-btn">å‡ºç™¼ï¼</button>
    </div>
</div>

<script>
    let allData = [];
    let stagePool = [];
    let currentLv = 1;
    let hp = 3;
    let progress = 0;
    const goal = 10;
    let currentQ = null;

    async function init() {
        try {
            const res = await fetch('quiz.json');
            allData = await res.json();
            showOverlay("æŒ‘æˆ°é–‹å§‹", "æº–å‚™å¥½è¾¨æ L7-L12 çš„ç›¸ä¼¼å­—äº†å—ï¼Ÿ\né¢å‘å³é‚Šè¡å‘çµ‚é»å§ï¼");
        } catch (e) { document.getElementById('q-text').innerText = "è®€å–å¤±æ•—"; }
    }

    function showOverlay(title, msg, btnText = "é–‹å§‹æŒ‘æˆ°") {
        const screen = document.getElementById('screen');
        document.getElementById('screen-title').innerText = title;
        document.getElementById('screen-msg').innerText = msg;
        document.getElementById('screen-btn').innerText = btnText;
        screen.style.display = 'flex';
    }

    function startStage() {
        document.getElementById('screen').style.display = 'none';
        hp = 3; progress = 0;
        updateUI();
        stagePool = allData.filter(d => d.level === currentLv);
        nextQ();
    }

    function nextQ() {
        currentQ = stagePool[Math.floor(Math.random() * stagePool.length)];
        document.getElementById('q-text').innerText = currentQ.q;
        document.getElementById('q-text').style.color = "#2c3e50";
        
        let opts = [...currentQ.options].sort(() => Math.random() - 0.5);
        for(let i=0; i<3; i++) {
            const btn = document.getElementById(`opt${i}`);
            btn.innerText = opts[i] || "";
            btn.className = "btn";
        }
    }

    function guess(idx) {
        const btn = document.getElementById(`opt${idx}`);
        if(btn.innerText === currentQ.ans) {
            progress++;
            updateUI();
            if(progress >= goal) winStage();
            else nextQ();
        } else {
            hp--;
            btn.classList.add('wrong');
            document.getElementById('q-text').innerText = `æ­£ç¢ºç­”æ¡ˆï¼š${currentQ.ans}`;
            document.getElementById('q-text').style.color = "var(--error)";
            updateUI();
            if(hp <= 0) showOverlay("æŒ‘æˆ°å¤±æ•—", "åˆ¥ç°å¿ƒï¼Œé‡ä¾†ä¸€éæœƒæ›´ç†Ÿç·´ï¼", "é‡è©¦æœ¬é—œ");
            else setTimeout(nextQ, 1000);
        }
    }

    function updateUI() {
        document.getElementById('hp-display').innerText = "â¤ï¸".repeat(hp);
        document.getElementById('lv-num').innerText = currentLv;
        const percent = (progress / goal) * 100;
        document.getElementById('prog').style.width = percent + "%";
        // å°äººå‘å³ç§»å‹•
        document.getElementById('char').style.left = `calc(${percent}% - 20px)`;
    }

    function winStage() {
        if(currentLv === 1) {
            currentLv = 2;
            showOverlay("é—œå¡ 1 é€šéï¼", "å¤ªæ£’äº†ï¼æ¥ä¸‹ä¾†æŒ‘æˆ° L10-L12 çš„å…§å®¹ï¼", "é€²å…¥ç¬¬ 2 é—œ");
        } else {
            showOverlay("æ­å–œå…¨æ•¸é€šé—œï¼", "ä½ å·²ç¶“æˆç‚ºç›¸ä¼¼å­—è¾¨æå¤§å¸«ï¼", "å†æ¬¡æŒ‘æˆ°");
            currentLv = 1;
        }
    }

    init();
</script>
</body>
</html>