<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº·è»’å››ä¸Šç›¸ä¼¼å­—å¤§æŒ‘æˆ°</title>
    <style>
        :root { --primary: #2980b9; --secondary: #27ae60; --bg: #f5f6fa; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .game-card { background: white; width: 90%; max-width: 600px; padding: 25px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; }
        .level-selector { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; }
        .lv-btn { padding: 10px 20px; border: none; border-radius: 50px; cursor: pointer; background: #dcdde1; transition: 0.3s; font-weight: bold; }
        .lv-btn.active { background: var(--primary); color: white; }
        .stats { display: flex; justify-content: space-between; font-size: 1.2rem; margin: 15px 0; color: #353b48; font-weight: bold; }
        .question-area { background: #f1f2f6; height: 100px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; border-radius: 15px; margin-bottom: 20px; color: #2f3640; border: 3px solid #dcdde1; padding: 0 10px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .hole { height: 110px; background: #7f8c8d; border-radius: 15px; position: relative; overflow: hidden; border-bottom: 6px solid #2f3640; }
        .mole { position: absolute; top: 100%; left: 0; width: 100%; height: 100%; background: #e67e22; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; transition: top 0.15s ease-out; cursor: pointer; user-select: none; }
        .mole.up { top: 0; }
        #start-btn { margin-top: 25px; width: 100%; padding: 15px; font-size: 1.3rem; border: none; border-radius: 10px; background: var(--secondary); color: white; cursor: pointer; box-shadow: 0 5px 0 #1e8449; }
        #start-btn:active { transform: translateY(3px); box-shadow: none; }
        #status-msg { font-size: 0.9rem; color: #7f8c8d; margin-top: 10px; }
    </style>
</head>
<body>

<div class="game-card">
    <h2>ğŸ¯ åº·è»’å››ä¸Š ç›¸ä¼¼å­—åœ°é¼ </h2>
    
    <div class="level-selector">
        <button class="lv-btn active" data-lv="1" onclick="changeLevel(1)">ç¬¬ä¸€é—œ (L7-L9)</button>
        <button class="lv-btn" data-lv="2" onclick="changeLevel(2)">ç¬¬äºŒé—œ (L10-L12)</button>
    </div>

    <div class="stats">
        <div>åˆ†æ•¸ï¼š<span id="score">0</span></div>
        <div>å‰©é¤˜æ™‚é–“ï¼š<span id="time">45</span>s</div>
    </div>

    <div class="question-area" id="question">è«‹é¸æ“‡é—œå¡ä¸¦é»æ“Šé–‹å§‹</div>

    <div class="grid" id="game-grid">
        <div class="hole"><div class="mole" onclick="handleHit(0)"></div></div>
        <div class="hole"><div class="mole" onclick="handleHit(1)"></div></div>
        <div class="hole"><div class="mole" onclick="handleHit(2)"></div></div>
        <div class="hole"><div class="mole" onclick="handleHit(3)"></div></div>
        <div class="hole"><div class="mole" onclick="handleHit(4)"></div></div>
        <div class="hole"><div class="mole" onclick="handleHit(5)"></div></div>
    </div>

    <button id="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    <div id="status-msg">æ­£åœ¨è¼‰å…¥é¡Œåº«...</div>
</div>

<script>
    let rawData = [];
    let currentPool = [];
    let currentQuiz = null;
    let score = 0;
    let timeLeft = 45;
    let gameInterval, moleInterval;
    let activeLevel = 1;
    const moles = document.querySelectorAll('.mole');

    async function init() {
        try {
            const res = await fetch('quiz.json');
            if (!res.ok) throw new Error();
            rawData = await res.json();
            document.getElementById('status-msg').innerText = "âœ… é¡Œåº«è¼‰å…¥æˆåŠŸï¼";
            changeLevel(1);
        } catch (e) {
            document.getElementById('status-msg').innerText = "âŒ è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèªèˆ‡ quiz.json æ”¾åœ¨ä¸€èµ·";
            document.getElementById('status-msg').style.color = "red";
        }
    }

    function changeLevel(lv) {
        if(gameInterval) return;
        activeLevel = lv;
        document.querySelectorAll('.lv-btn').forEach(b => b.classList.toggle('active', b.dataset.lv == lv));
        currentPool = rawData.filter(d => d.level === lv);
        document.getElementById('question').innerText = `å·²æº–å‚™å¥½ç¬¬ ${lv} é—œ`;
    }

    function startGame() {
        if (currentPool.length === 0) return;
        score = 0; timeLeft = 45;
        document.getElementById('score').innerText = score;
        document.getElementById('start-btn').disabled = true;
        nextQuestion();
        gameInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('time').innerText = timeLeft;
            if (timeLeft <= 0) endGame();
        }, 1000);
        showMole();
    }

    function nextQuestion() {
        currentQuiz = currentPool[Math.floor(Math.random() * currentPool.length)];
        document.getElementById('question').innerText = currentQuiz.q;
    }

    function showMole() {
        if (timeLeft <= 0) return;
        const idx = Math.floor(Math.random() * moles.length);
        const opt = currentQuiz.options[Math.floor(Math.random() * currentQuiz.options.length)];
        moles[idx].innerText = opt;
        moles[idx].classList.add('up');
        setTimeout(() => {
            moles[idx].classList.remove('up');
            moleInterval = setTimeout(showMole, activeLevel === 1 ? 850 : 650);
        }, 1100);
    }

    function handleHit(idx) {
        const mole = moles[idx];
        if (!mole.classList.contains('up')) return;
        if (mole.innerText === currentQuiz.ans) {
            score += 10;
            nextQuestion();
        } else {
            score = Math.max(0, score - 5);
        }
        document.getElementById('score').innerText = score;
        mole.classList.remove('up');
    }

    function endGame() {
        clearInterval(gameInterval);
        clearTimeout(moleInterval);
        gameInterval = null;
        alert(`å®Œæˆï¼å¾—åˆ†ï¼š${score}`);
        document.getElementById('start-btn').disabled = false;
    }
    init();
</script>
</body>
</html>