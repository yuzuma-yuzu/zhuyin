<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>康軒四上相似字極速挑戰</title>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --error: #e74c3c; --bg: #f0f3f6; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .game-card { background: white; width: 95%; max-width: 500px; padding: 30px; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; }
        .lv-select { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .lv-btn { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 12px; background: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .lv-btn.active { border-color: var(--primary); background: var(--primary); color: white; }
        .stats { display: flex; justify-content: space-between; font-size: 1.1rem; margin-bottom: 20px; color: #666; }
        .combo-tag { color: var(--success); font-weight: bold; height: 24px; }
        .question-display { height: 120px; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; font-weight: bold; color: #2c3e50; background: #f8f9fa; border-radius: 16px; margin-bottom: 30px; border: 2px solid #eee; position: relative; }
        .option-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .opt-btn { padding: 20px 10px; font-size: 1.5rem; border: none; border-radius: 12px; background: #fff; box-shadow: 0 4px 0 #ddd; border: 1px solid #eee; cursor: pointer; transition: 0.1s; }
        .opt-btn:active { transform: translateY(3px); box-shadow: none; }
        .opt-btn:hover { background: #f1f1f1; }
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 24px; z-index: 10; }
        .big-btn { padding: 15px 50px; font-size: 1.5rem; background: var(--success); color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 6px 0 #27ae60; }
        .correct-flash { background: #d4edda !important; border-color: #28a745 !important; }
        .wrong-flash { background: #f8d7da !important; border-color: #dc3545 !important; }
    </style>
</head>
<body>

<div class="game-card">
    <div id="start-screen">
        <h2>相似字極速挑戰</h2>
        <p>點擊正確答案，挑戰連擊高分！</p>
        <button class="big-btn" onclick="startGame()">開始練習</button>
    </div>

    <div class="lv-select">
        <button class="lv-btn active" id="btn-l1" onclick="setLevel(1)">第一關 (L7-L9)</button>
        <button class="lv-btn" id="btn-l2" onclick="setLevel(2)">第二關 (L10-L12)</button>
    </div>

    <div class="stats">
        <div>分數：<span id="score">0</span></div>
        <div class="combo-tag" id="combo"></div>
        <div>時間：<span id="time">60</span>s</div>
    </div>

    <div class="question-display" id="q-text">準備好了嗎？</div>

    <div class="option-container">
        <button class="opt-btn" onclick="checkAnswer(0)" id="opt0">-</button>
        <button class="opt-btn" onclick="checkAnswer(1)" id="opt1">-</button>
        <button class="opt-btn" onclick="checkAnswer(2)" id="opt2">-</button>
    </div>
</div>

<script>
    let allData = [];
    let currentPool = [];
    let currentQ = null;
    let score = 0;
    let combo = 0;
    let timeLeft = 60;
    let timer = null;

    async function loadData() {
        try {
            const res = await fetch('quiz.json');
            allData = await res.json();
            setLevel(1);
        } catch (e) {
            document.getElementById('q-text').innerText = "找不到 quiz.json";
        }
    }

    function setLevel(lv) {
        document.getElementById('btn-l1').classList.toggle('active', lv === 1);
        document.getElementById('btn-l2').classList.toggle('active', lv === 2);
        currentPool = allData.filter(d => d.level === lv);
    }

    function startGame() {
        score = 0; combo = 0; timeLeft = 60;
        document.getElementById('start-screen').style.display = 'none';
        updateStats();
        nextQuestion();
        
        if(timer) clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            document.getElementById('time').innerText = timeLeft;
            if(timeLeft <= 0) endGame();
        }, 1000);
    }

    function nextQuestion() {
        currentQ = currentPool[Math.floor(Math.random() * currentPool.length)];
        document.getElementById('q-text').innerText = currentQ.q;
        
        // 打亂選項順序
        let opts = [...currentQ.options].sort(() => Math.random() - 0.5);
        for(let i=0; i<3; i++) {
            document.getElementById(`opt${i}`).innerText = opts[i] || "";
        }
    }

    function checkAnswer(idx) {
        const selected = document.getElementById(`opt${idx}`).innerText;
        const display = document.getElementById('q-text');
        
        if(selected === currentQ.ans) {
            score += (10 + Math.floor(combo/5) * 5); // 連擊越高分越多
            combo++;
            flashEffect('correct-flash');
            nextQuestion();
        } else {
            combo = 0;
            flashEffect('wrong-flash');
            // 答錯顯示提示一秒
            display.innerText = `答案是：${currentQ.ans}`;
            setTimeout(nextQuestion, 800);
        }
        updateStats();
    }

    function flashEffect(className) {
        const box = document.getElementById('q-text');
        box.classList.add(className);
        setTimeout(() => box.classList.remove(className), 200);
    }

    function updateStats() {
        document.getElementById('score').innerText = score;
        document.getElementById('combo').innerText = combo >= 3 ? `${combo} COMBO!` : "";
    }

    function endGame() {
        clearInterval(timer);
        alert(`練習結束！\n您的得分：${score}\n最高連擊：${combo}`);
        document.getElementById('start-screen').style.display = 'flex';
    }

    loadData();
</script>
</body>
</html>